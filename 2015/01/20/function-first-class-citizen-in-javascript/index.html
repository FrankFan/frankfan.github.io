<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> js中的一等公民——Function()对象 · Frank Fan's Blog</title><meta name="description" content="js中的一等公民——Function()对象 - Frank Fan"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://fy98.com/atom.xml" title="Frank Fan's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">首页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">关于</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">js中的一等公民——Function()对象</h1><div class="post-info">2015年1月20日</div><div class="post-content"><h2 id="Function-对象概要"><a href="#Function-对象概要" class="headerlink" title="Function()对象概要"></a>Function()对象概要</h2><p>函数是代码语句的容器，可以使用圆括号操作符<code>()</code>来调用。调用函数时，参数可以在圆括号内传递，以便函数中的语句可以访问这些特定值。</p>
<p>如下代码创建了两个版本的<code>addNumbers</code>函数对象，一个使用<code>new</code>操作符，另一个使用更常见的<code>字面量模式</code>。两者都需要两个参数。两种函数在调用时，都可以在圆括号操作符<code>()</code>中传递参数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> addNumbersA = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'num1'</span>, <span class="string">'num2'</span>, <span class="string">'return num1 + num2'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(addNumbersA(<span class="number">2</span>, <span class="number">3</span>)); <span class="comment">//output 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以使用字面量模式，这种方式更常用</span></span><br><span class="line"><span class="keyword">var</span> addNumbersB = <span class="function"><span class="keyword">function</span>(<span class="params">num1, num2</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> num1 + num2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(addNumbersA(<span class="number">2</span>, <span class="number">2</span>)); <span class="comment">//output 4</span></span><br></pre></td></tr></table></figure>
<p>函数可用于返回值、构建对象，或者作为一种机制简单的运行代码。Javascript的函数有很多种用途，但从最基本的形式来说，函数只是可执行语句的唯一作用域。</p>
<h2 id="Function-的参数"><a href="#Function-的参数" class="headerlink" title="Function()的参数"></a>Function()的参数</h2><p>Function()构造函数采用不定数量的参数，但Function()构造函数的最后一个参数是一个包含具有函数体语句的字符串。在最后一个参数之前传递给构造函数的任何参数都可用于创建函数。也可以将多个参数放在一起以逗号分隔形成字符串进行传递。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> addFunction = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'num1'</span>, <span class="string">'num2'</span>, <span class="string">'return num1 + num2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同样，所有参数放在一起用逗号隔开形成字符串作为第一个参数，第二个参数为函数体</span></span><br><span class="line"><span class="keyword">var</span> timesFunction = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'num1,num2'</span>, <span class="string">'return num1 * num2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(addFunction(<span class="number">2</span>, <span class="number">2</span>), timesFunction(<span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 与此同时，还可以使用表示形式初始化函数的方式，这种形式更常用</span></span><br><span class="line"><span class="keyword">var</span> addFunction2 = <span class="function"><span class="keyword">function</span>(<span class="params">num1, num2</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> num1 + num2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 语句形式</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addFunction3</span>(<span class="params">num1,num2</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> num1 + num2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<blockquote>
<ul>
<li>不推荐或通常不直接利用Function()构造函数，因为Javascript将使用<code>eval()</code>来解析包含函数逻辑的字符串。很多人认为不必要使用<code>eval()</code>，因为如果使用它，很有可能出现代码设计缺陷。</li>
<li>使用带<code>new</code>关键字的Function()构造函数创建函数对象，与仅使用构造函数创建函数对象具有先攻的效果，如<code>new Function(&#39;x&#39;, &#39;return x&#39;)</code>与<code>function(&#39;x&#39;, &#39;return x&#39;)</code>。</li>
<li>直接使用Function()构造函数时没有创建闭包。</li>
</ul>
</blockquote>
<h2 id="函数总有返回值"><a href="#函数总有返回值" class="headerlink" title="函数总有返回值"></a>函数总有返回值</h2><p>由于可以创建一个函数以简单的执行代码语句，因此函数返回一个值也是很常见的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sayHi = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">'Hi'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(sayHi()); <span class="comment">// output Hi</span></span><br></pre></td></tr></table></figure>
<p>如果函数没有指定返回值，则会返回<code>undefined</code>。下面代码调用yelp函数，它将字符串<code>&#39;yelp&#39;</code>打印至控制台，切不会显示返回值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sayHi = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">'Hi'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(sayHi()); <span class="comment">// output Hi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> yelp = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">// 如果不声明返回值，则返回undefined</span></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'I am yelping!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output true</span></span><br><span class="line"><span class="built_in">console</span>.log(yelp() === <span class="literal">undefined</span>);</span><br></pre></td></tr></table></figure>
<p>这里的重点是，即使没有显示地提供要返回的值，所有函数也都返回了一个值。如果不指定要返回的值，则返回的值是<code>undefined</code>。</p>
<h2 id="函数是一等公民——不仅语法，还有值"><a href="#函数是一等公民——不仅语法，还有值" class="headerlink" title="函数是一等公民——不仅语法，还有值"></a>函数是一等公民——不仅语法，还有值</h2><p>在Javascript中，函数是对象。这意味着函数可以存储在一个变量、数组或对象中。同时，函数还可以传递给函数，并由函数返回。函数拥有属性，因为他是一个对象。所有这些因素是函数在Javascript中成为了<code>一等公民 —— first-class citizen</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数可以保存在变量（funcA）、数组（funcB）和对象（funcC）中</span></span><br><span class="line"><span class="keyword">var</span> funcA = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;; <span class="comment">// 调用方式： funcA()</span></span><br><span class="line"><span class="keyword">var</span> funcB = [<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;]; <span class="comment">// 调用方式： funcB[0]()</span></span><br><span class="line"><span class="keyword">var</span> funcC = &#123; <span class="attr">method</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; &#125; &#125;; <span class="comment">// 调用方式： funcC.method() 或者 funcC['method']()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数可以作为参数传递，也可以作为返回值返回</span></span><br><span class="line"><span class="keyword">var</span> funcD = <span class="function"><span class="keyword">function</span>(<span class="params">func</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> func;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> runFuncPassedToFuncD = funcD(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'Hi'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">runFuncPassedToFuncD();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数是对象，也就意味着函数也拥有属性</span></span><br><span class="line"><span class="keyword">var</span> funcE = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; &#125;;</span><br><span class="line">funcE.answer = <span class="string">'yup'</span>; <span class="comment">// 实例化属性</span></span><br><span class="line"><span class="built_in">console</span>.log(funcE.answer); <span class="comment">// output yup</span></span><br></pre></td></tr></table></figure>
<p>至关重要的是要意识到函数是一个对象，因此函数也是一个值。它可以像Javascript中的其他表达式那样被传递或增加。</p>
<h2 id="函数的参数传递"><a href="#函数的参数传递" class="headerlink" title="函数的参数传递"></a>函数的参数传递</h2><p>在调用函数时，参数是将值传递给函数作用域的工具。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> addFunction = <span class="function"><span class="keyword">function</span>(<span class="params">number1, number2</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> sum = number1 + number2;</span><br><span class="line">	<span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(addFunction(<span class="number">2</span>, <span class="number">6</span>)); <span class="comment">// output 8</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong></p>
<blockquote>
<ul>
<li>与其他编程语言相比，在Javascript中省略参数是完全合法的，即使已定义了接收这些参数的函数。只是为省略的参数赋予了<code>undefined</code>值。当然，省略参数后函数有可能无法正常工作。</li>
<li>如果向函数传递意想不到的参数（那些在创建函数时没有被定义的参数），则不会发生任何错误。而且可以从<code>arguments</code>对象访问这些参数，<code>arguments</code>对象对所有的函数都是可用的。</li>
</ul>
</blockquote>
<h2 id="this和arguments适用于所有函数"><a href="#this和arguments适用于所有函数" class="headerlink" title="this和arguments适用于所有函数"></a>this和arguments适用于所有函数</h2><p>在所有函数的作用域/函数体内，<code>this</code>和<code>arguments</code>值都是可用的。</p>
<p><code>arguments</code>对象是一种类数组的对象，它包含所有传递给函数的参数。在下列代码中，即使在定义函数时不指定参数，在调用时如果还是发送参数，我们也可以依靠传递给函数的<code>arguments</code>数组来访问参数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">arguments</span>[<span class="number">0</span>] + <span class="built_in">arguments</span>[<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">3</span>, <span class="number">5</span>)); <span class="comment">// output 8</span></span><br></pre></td></tr></table></figure>
<p>传递给所有函数的<code>this</code>关键字都是对<code>包含函数的对象的引用</code>。如您所料，作为属性包含在对象内的函数（即方法），也是可以使用<code>this</code>来获得对“父”对象的引用。当函数在全局作用域中定义时，<code>this</code>值是全局对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myObject1 = &#123;</span><br><span class="line">	name: <span class="string">'myObject1'</span>,</span><br><span class="line">	myMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="keyword">this</span>); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">myObject1.myMethod(); <span class="comment">// output 'myObject1'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myObject2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="keyword">this</span>); &#125;</span><br><span class="line"></span><br><span class="line">myObject2(); <span class="comment">// output 'window对象'</span></span><br></pre></td></tr></table></figure>
<h2 id="arguments-callee属性"><a href="#arguments-callee属性" class="headerlink" title="arguments.callee属性"></a>arguments.callee属性</h2><p><code>arguments</code>对象拥有名为<code>callee</code>的属性，它是对当前执行函数的引用。该属性可以用于从函数的作用域内引用函数（如<code>arguments.callee</code>）——自我引用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="built_in">arguments</span>.callee); <span class="comment">// output</span></span><br><span class="line">	<span class="comment">// callee 可以用于对foo函数进行递归调用（例如，arguments.callee()）</span></span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>
<p>当函数需要递归调用时，它非常有用。</p>
<h2 id="函数实例的length属性和arguments-length"><a href="#函数实例的length属性和arguments-length" class="headerlink" title="函数实例的length属性和arguments.length"></a>函数实例的length属性和arguments.length</h2><p><code>arguments</code>对象有一个独特的<code>length</code>属性。大家可能会认为这个<code>length</code>属性将提供已定义参数的数量，实际上，它给出的是在<code>调用时</code>发送给函数的参数数量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myFunction = <span class="function"><span class="keyword">function</span>(<span class="params">z, s, d</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">arguments</span>.length;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(myFunction()); <span class="comment">// output 0 因为没有传入任何参数</span></span><br></pre></td></tr></table></figure>
<p>通过使用Function()实例的<code>length</code>属性，实际上可以获得函数所需要的参数总数量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myFunction = <span class="function"><span class="keyword">function</span>(<span class="params">z, s, d, e, r, m, q</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> myFunction.length;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(myFunction()); <span class="comment">// output 7</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong></p>
<blockquote>
<p>自Javascript 1.4 开始，<code>arguments.length</code>属性就被废弃掉了，可以从函数对象的<code>length</code>属性获取发送给函数的参数数量。<br>因此，接下来可以通过利用<code>callee</code>属性获得长度值，首先获得对被调用函数的引用（即<code>arguments.callee.length</code>）。</p>
</blockquote>
<h2 id="重定义函数参数"><a href="#重定义函数参数" class="headerlink" title="重定义函数参数"></a>重定义函数参数</h2><p>函数的参数可以直接在函数内部或通过使用<code>arguments</code>数组进行重新定义。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">var</span> bar = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myFunction = <span class="function"><span class="keyword">function</span>(<span class="params">foo, bar</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">arguments</span>[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">	bar = <span class="literal">true</span>;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="built_in">arguments</span>[<span class="number">0</span>], bar); <span class="comment">// output true true</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">myFunction();</span><br></pre></td></tr></table></figure>
<p>请注意，可以使用<code>arguments</code>索引或直接为参数再指定一个新值来重新定义<code>bar</code>参数的值。</p>
<h2 id="代码执行完成前取消函数执行"><a href="#代码执行完成前取消函数执行" class="headerlink" title="代码执行完成前取消函数执行"></a>代码执行完成前取消函数执行</h2><p>可以通过返回有值或无值的<code>return</code>关键字在调用时随时取消函数执行。下面代码中如果参数是<code>undefined</code>或非数字，则取消执行<code>add</code>函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>)</span>&#123;</span><br><span class="line">	<span class="comment">// 如果参数不是数字，返回错误</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">typeof</span> x !== <span class="string">'number'</span> || <span class="keyword">typeof</span> y !== <span class="string">'number'</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">'pass in numbers'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">3</span>, <span class="number">4</span>)); <span class="comment">// output 7</span></span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="string">'2'</span>, <span class="string">'2'</span>)); <span class="comment">// output 'pass in numbers'</span></span><br></pre></td></tr></table></figure>
<p>这里的重点是，可以在函数执行的任意点上通过使用<code>return</code>关键字来取消函数的执行。</p>
<h2 id="定义函数"><a href="#定义函数" class="headerlink" title="定义函数"></a>定义函数</h2><p>函数的定义有三种不同的方式：<code>函数构造函数</code>、<code>函数语句</code>和<code>函数表达式</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数构造函数：最后一个参数是函数逻辑，之前的都是参数</span></span><br><span class="line"><span class="keyword">var</span> addConstructor = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'return x + y'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数语句</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addStatement</span>(<span class="params">x, y</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数表达式</span></span><br><span class="line"><span class="keyword">var</span> addExpression = <span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(addConstructor(<span class="number">2</span>, <span class="number">2</span>), addStatement(<span class="number">2</span>, <span class="number">3</span>), addExpression(<span class="number">2</span>, <span class="number">4</span>));</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<blockquote>
<ul>
<li>有些人说，第四种定义函数的方式被称为“命名函数表达式”。命名函数表达式只是一个包含名称的函数表达式（如 <code>var add = function add(x, y){return x + y;}</code>）。</li>
</ul>
</blockquote>
<p>##调用函数<br>使用4中不同的场景或模式调用函数。</p>
<blockquote>
<ul>
<li>作为函数</li>
<li>作为方法</li>
<li>作为构造函数</li>
<li>使用<code>apply()</code>或<code>call()</code></li>
</ul>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数模式</span></span><br><span class="line"><span class="keyword">var</span> myFunction = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="string">'foo'</span>;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(myFunction()); <span class="comment">// output 'foo'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法模式</span></span><br><span class="line"><span class="keyword">var</span> myObject = &#123; <span class="attr">myFunction</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="string">'bar'</span>; &#125;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(myObject.myFunction()); <span class="comment">// output 'bar'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数模式</span></span><br><span class="line"><span class="keyword">var</span> Cody = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.living = <span class="literal">true</span>,</span><br><span class="line">	<span class="keyword">this</span>.age = <span class="number">33</span>,</span><br><span class="line">	<span class="keyword">this</span>.gender = <span class="string">'male'</span>,</span><br><span class="line">	<span class="keyword">this</span>.getGender = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.gender &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> cody = <span class="keyword">new</span> Cody(); <span class="comment">// 通过Cody构造函数调用</span></span><br><span class="line"><span class="built_in">console</span>.log(cody); <span class="comment">// output cody对象和属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// apply() 和 call() 模式</span></span><br><span class="line"><span class="keyword">var</span> greet = &#123;</span><br><span class="line">	runGreet: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="keyword">this</span>.name, <span class="built_in">arguments</span>[<span class="number">0</span>], <span class="built_in">arguments</span>[<span class="number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cody = &#123; <span class="attr">name</span>: <span class="string">'cody'</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> lisa = &#123; <span class="attr">name</span>: <span class="string">'lisa'</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 cody 对象上调用 runGreet 函数</span></span><br><span class="line">greet.runGreet.call(cody, <span class="string">'foo'</span>, <span class="string">'bar'</span>); <span class="comment">// output 'cody foo bar'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 lisa 对象上调用 runGreet 函数</span></span><br><span class="line">greet.runGreet.apply(lisa, [<span class="string">'foo'</span>, <span class="string">'bar'</span>]); <span class="comment">// output 'lisa foo bar'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 注意 call() 和 apply() 之间的区别是函数调用时，参数传递的不同，</span></span><br><span class="line"><span class="comment">* 前者传递多个分开的参数，后者传递多个参数组成的数组</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>要理解这4中调用模式，因为以后遇到的代码可能会用到其中一种模式。</p>
<h2 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h2><p>匿名函数是一种没有给出标示符的函数。匿名函数主要用于将函数作为参数传递给另一个函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// function()&#123;console.log('hi');&#125;; // 匿名函数，但无法调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个函数来执行匿名函数</span></span><br><span class="line"><span class="keyword">var</span> sayHi = <span class="function"><span class="keyword">function</span>(<span class="params">f</span>)</span>&#123;</span><br><span class="line">	f();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将匿名函数作为参数传递</span></span><br><span class="line">sayHi(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'hi'</span>); <span class="comment">// output 'hi'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="自调用的函数表达式"><a href="#自调用的函数表达式" class="headerlink" title="自调用的函数表达式"></a>自调用的函数表达式</h2><p>通过圆括号操作符可以在定义函数表达式后立即调用该函数表达式（除了由<code>Function()</code>构造函数创建的函数）。下面创建了一个<code>sayWord()</code>函数表达式，然后立即调用该函数。这就是自调用函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// output 'hello world.'</span></span><br><span class="line"><span class="keyword">var</span> sayWord = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">'hello world.'</span>); &#125;();</span><br></pre></td></tr></table></figure>
<h2 id="自调用的匿名函数语句"><a href="#自调用的匿名函数语句" class="headerlink" title="自调用的匿名函数语句"></a>自调用的匿名函数语句</h2><p>可以创建一个自调用的匿名函数语句，这叫做自调用匿名函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 最经常使用的匿名函数</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(msg);</span><br><span class="line">&#125; )(<span class="string">'Hi'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 看起来有点不一样，但效果一样</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(msg);</span><br><span class="line">&#125;(<span class="string">'Hi 1'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更简短的方式</span></span><br><span class="line">!<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123; <span class="built_in">console</span>.log(msg); &#125;(<span class="string">'Hi 2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意，下面的代码报错：Uncaught SyntaxError: Unexpected token )</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHi</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="string">'Hi'</span>);&#125;()</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<blockquote>
<ul>
<li>根据ECMAScript标准，如果要立即调用函数，需要使用函数外面的圆括号（或任何将函数转化为表达式的符号）。</li>
</ul>
</blockquote>
<h2 id="函数可以嵌套"><a href="#函数可以嵌套" class="headerlink" title="函数可以嵌套"></a>函数可以嵌套</h2><p>函数可以无限地嵌套在其他函数内部。在如下代码中，在<code>bar</code>函数内部封装了<code>goo</code>函数，同时<code>bar</code>函数位于<code>foo</code>函数内部。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> goo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">// ouput window 对象</span></span><br><span class="line">		&#125;();</span><br><span class="line">	&#125;();</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>
<p>这里的要点是，函数是可以嵌套的，并且嵌套的深度是没有限制的。</p>
<p><strong>注意：</strong></p>
<blockquote>
<ul>
<li>请记住，嵌套函数的<code>this</code>值在ECMAScript3、Javascript 1.5中是head对象（如在web浏览器中是window对象）。</li>
</ul>
</blockquote>
<h2 id="给函数传递函数，从函数返回函数"><a href="#给函数传递函数，从函数返回函数" class="headerlink" title="给函数传递函数，从函数返回函数"></a>给函数传递函数，从函数返回函数</h2><p>如上所述，函数在Javascript世界中是“一等公民”。由于函数是一个值，并且可以将任何类型的值传递给函数，因此函数可以被传递给函数。函数可以接收/返回其他函数。它们有时被称为“高阶函数”。</p>
<p>如下代码，将一个匿名函数传递给<code>foo函数</code>，它是稍后立即从<code>foo函数</code>返回的函数。这个匿名函数是<code>bar</code>变量指向的函数，<code>foo</code>函数先接收，然后返回该匿名函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数可以传入，也可以传出</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span>(<span class="params">f</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = foo(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="string">'Hi'</span>); &#125;);</span><br><span class="line"></span><br><span class="line">bar(); <span class="comment">// outpu 'Hi'</span></span><br></pre></td></tr></table></figure>
<p>因此，当<code>bar</code>被调用时它调用传递给<code>foo()</code>匿名函数，然后从<code>foo()函数</code>传回，并从<code>bar</code>变量引用。所有这些都是在展示，函数可以像任何其他的值一样被传递。</p>
<h2 id="函数定义之前调用（函数提升）"><a href="#函数定义之前调用（函数提升）" class="headerlink" title="函数定义之前调用（函数提升）"></a>函数定义之前调用（函数提升）</h2><p>在真正定义函数语句之前，可以在执行时调用该函数语句。这有点奇怪，但你应该了解它，这样你就可以利用它，或者至少知道遇到它时会发生什么事情。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例 1</span></span><br><span class="line"><span class="keyword">var</span> speak = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	sayYo(); <span class="comment">// sayYo() 还没有被定义，但依然可以执行，并输出 'yo'</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">sayYo</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="string">'yo'</span>); &#125;</span><br><span class="line">&#125;(); <span class="comment">// invoke</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例 2</span></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">2</span>, <span class="number">3</span>)); <span class="comment">// sum() 没定义之前，被调用，依然可以执行</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">x, y</span>)</span>&#123; <span class="keyword">return</span> x + y; &#125;</span><br></pre></td></tr></table></figure>
<p>上述情况发生的原因是，在运行代码之前，函数语句其实已经被编译器解释，并添加至执行堆栈/上下文。在使用函数语句时要确保自己理解这一点。</p>
<p><strong>注意</strong></p>
<blockquote>
<p>被定义为<code>“函数表达式”</code>的函数没有被提升，只有<code>“函数语句”</code>被提升。</p>
</blockquote>
<h2 id="函数可以调用自身（递归）"><a href="#函数可以调用自身（递归）" class="headerlink" title="函数可以调用自身（递归）"></a>函数可以调用自身（递归）</h2><p>函数调用自身完全是合法的。事实上，这是非常有名的编码模式。在如下代码中，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var coundDownFrom = function coundDownFrom(num)&#123;</span><br><span class="line">	console.log(num);</span><br><span class="line">	num--; //改变参数值</span><br><span class="line">	if(num &lt; 0)&#123; return false; &#125; // 如果 num &lt; 0 ,停止递归</span><br><span class="line">	// 如果是匿名函数的话，也可以使用 arguments.callee(num) 进行递归</span><br><span class="line">	coundDownFrom(num);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">coundDownFrom(5); // 调用函数，输出 5,4,3,2,1,0</span><br></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2015/01/22/this-in-javascript/" class="prev">PREV</a><a href="/2015/01/15/scope-and-closures-in-javascript/" class="next">NEXT</a></div><div class="copyright"><p>© 2014 - 2018 <a href="http://fy98.com">Frank Fan</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>