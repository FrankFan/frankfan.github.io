<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> javascript中的事件揭秘 · Frank Fan's Blog</title><meta name="description" content="javascript中的事件揭秘 - Frank Fan"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://fy98.com/atom.xml" title="Frank Fan's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">首页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">关于</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">javascript中的事件揭秘</h1><div class="post-info">2014年10月5日</div><div class="post-content"><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Javascript中的事件可以和html交互。</p>
<p>事件流<br><strong>IE&amp;Opera</strong>：事件冒泡<br><strong>其他</strong> 浏览器： 事件捕获</p>
<p><strong>事件冒泡</strong>：事件由最具体的元素（文档中嵌套层次最深的那个节点）接收，然后逐级向上传播至最不具体的那个节点（文档）。</p>
<p><strong>事件捕获</strong>：不太具体的节点应该更早接收到事件，而最具体的节点应该最后接收到事件。</p>
<h2 id="事件处理程序"><a href="#事件处理程序" class="headerlink" title="事件处理程序"></a>事件处理程序</h2><h3 id="HTML事件"><a href="#HTML事件" class="headerlink" title="HTML事件"></a>HTML事件</h3><p>缺点：</p>
<ul>
<li>HTML和js代码紧密的耦合在一起，</li>
<li>不利于扩展，</li>
<li>只能添加一个事件</li>
</ul>
<h3 id="DOM0-级事件处理程序"><a href="#DOM0-级事件处理程序" class="headerlink" title="DOM0 级事件处理程序"></a>DOM0 级事件处理程序</h3><p>把一个函数赋值给一个事件处理程序的属性。<br>可以添加多个事件处理程序。</p>
<h3 id="DOM2-级事件处理程序"><a href="#DOM2-级事件处理程序" class="headerlink" title="DOM2 级事件处理程序"></a>DOM2 级事件处理程序</h3><p>DOM2级事件定义了2个方法：<br>用于处理指定和删除事件处理程序的操作：addEventListener() 和 removeEventListener()<br>都接收三个参数：要处理的事件名、作为事件处理程序的函数和布尔值（true：表示在事件捕获阶段调用事件处理程序 false：表示事件在事件冒泡阶段调用事件处理程序）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn3 = <span class="built_in">document</span>.getElementById(<span class="string">'btn3'</span>);</span><br><span class="line">btn3.addEventListener(<span class="string">'click'</span>, showMessage, <span class="literal">false</span>); <span class="comment">// 添加事件</span></span><br><span class="line"></span><br><span class="line">btn3.removeEventListener(<span class="string">'click'</span>, showMessage, <span class="literal">false</span>); <span class="comment">// 删除事件</span></span><br></pre></td></tr></table></figure>
<h3 id="IE事件处理程序"><a href="#IE事件处理程序" class="headerlink" title="IE事件处理程序"></a>IE事件处理程序</h3><p>attachEvent() 添加事件处理程序<br>detachEvent() 删除事件处理程序<br>都接收两个参数：事件处理程序名称和事件处理程序函数<br>不加第三个参数是因为IE8之前的浏览器只支持事件冒泡。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">btn3.attachEvent(<span class="string">'onclick'</span>, showMessage); <span class="comment">// 添加事件处理程序</span></span><br><span class="line">btn3.detachEvent(<span class="string">'onclick'</span>, showMessage); <span class="comment">// 删除事件处理程序</span></span><br></pre></td></tr></table></figure></p>
<h3 id="跨浏览器事件处理程序"><a href="#跨浏览器事件处理程序" class="headerlink" title="跨浏览器事件处理程序"></a>跨浏览器事件处理程序</h3><p>使用浏览器能力检测（Browser Compatibility）方法</p>
<p>封装方法：跨浏览器事件处理程序方法封装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> eventUtil = &#123;</span><br><span class="line">	<span class="comment">// 添加句柄</span></span><br><span class="line">	addHandler: <span class="function"><span class="keyword">function</span> (<span class="params">element, type, handler</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(element.addEventListener)&#123; <span class="comment">//DOM2级</span></span><br><span class="line">			element.addEventListener(type, handler, <span class="literal">false</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.attachEvent)&#123; <span class="comment">// DOM0级 IE</span></span><br><span class="line">			element.attachEvent(<span class="string">'on'</span> + type, handler);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123; <span class="comment">// HTML事件</span></span><br><span class="line">			element[<span class="string">'on'</span> + type] = handler;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 删除句柄</span></span><br><span class="line">	removeHandler: <span class="function"><span class="keyword">function</span> (<span class="params">element, type, handler</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(element.removeEventListener)&#123; <span class="comment">//DOM2级</span></span><br><span class="line">			element.removeEventListener(type, handler, <span class="literal">false</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.detachEvent)&#123; <span class="comment">// DOM0级 IE</span></span><br><span class="line">			element.detachEvent(<span class="string">'on'</span> + type, handler);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123; <span class="comment">// HTML事件</span></span><br><span class="line">			element[<span class="string">'on'</span> + type] = <span class="literal">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="DOM中的事件对象"><a href="#DOM中的事件对象" class="headerlink" title="DOM中的事件对象"></a>DOM中的事件对象</h2><p>在触发DOM上的事件时都会产生一个对象，叫做事件对象。</p>
<p>DOM事件对象event的属性：</p>
<h3 id="type属性"><a href="#type属性" class="headerlink" title="type属性"></a>type属性</h3><p>用于获取事件类型<br>如：<code>click</code>等</p>
<h3 id="target属性"><a href="#target属性" class="headerlink" title="target属性"></a>target属性</h3><p>用于获取事件目标<br>如：<code>target.nodeName</code></p>
<h3 id="stopPropagation-方法"><a href="#stopPropagation-方法" class="headerlink" title="stopPropagation() 方法"></a>stopPropagation() 方法</h3><p>用于阻止事件冒泡</p>
<h3 id="preventDefault-方法"><a href="#preventDefault-方法" class="headerlink" title="preventDefault() 方法"></a>preventDefault() 方法</h3><p>用于阻止事件的默认行为</p>
<h2 id="IE中的事件对象"><a href="#IE中的事件对象" class="headerlink" title="IE中的事件对象"></a>IE中的事件对象</h2><h3 id="type-属性"><a href="#type-属性" class="headerlink" title="type 属性"></a>type 属性</h3><p>用于获取事件类型</p>
<h3 id="srcElement-属性"><a href="#srcElement-属性" class="headerlink" title="srcElement 属性"></a>srcElement 属性</h3><p>用于获取事件目标<br>IE中没有e.target属性，而是 e.srcElement 属性。</p>
<p>所以，js中获取元素最兼容的写法是：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e = event || <span class="built_in">window</span>.event; <span class="comment">// IE8之前使用window.event 传递事件</span></span><br><span class="line"><span class="keyword">var</span> element = e.target || e.srcElement;</span><br></pre></td></tr></table></figure></p>
<h3 id="3-cancelBubble-属性"><a href="#3-cancelBubble-属性" class="headerlink" title="3. cancelBubble 属性"></a>3. cancelBubble 属性</h3><p>用于阻止事件冒泡<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">true</span>：表示阻止事件冒泡</span><br><span class="line">fales：表示不组织事件冒泡</span><br></pre></td></tr></table></figure></p>
<h3 id="4-returnValue-属性"><a href="#4-returnValue-属性" class="headerlink" title="4. returnValue 属性"></a>4. returnValue 属性</h3><p>用于阻止事件的默认行为<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">false</span>：表示阻止事件的默认行为</span><br></pre></td></tr></table></figure></p>
<p>继续封装eventUtil</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> eventUtil = &#123;</span><br><span class="line">	<span class="comment">// 添加句柄</span></span><br><span class="line">	addHandler: <span class="function"><span class="keyword">function</span> (<span class="params">element, type, handler</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(element.addEventListener)&#123; <span class="comment">//DOM2级</span></span><br><span class="line">			element.addEventListener(type, handler, <span class="literal">false</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.attachEvent)&#123; <span class="comment">// DOM0级 IE</span></span><br><span class="line">			element.attachEvent(<span class="string">'on'</span> + type, handler);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123; <span class="comment">// HTML事件</span></span><br><span class="line">			element[<span class="string">'on'</span> + type] = handler;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 删除句柄</span></span><br><span class="line">	removeHandler: <span class="function"><span class="keyword">function</span> (<span class="params">element, type, handler</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(element.removeEventListener)&#123; <span class="comment">//DOM2级</span></span><br><span class="line">			element.removeEventListener(type, handler, <span class="literal">false</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.detachEvent)&#123; <span class="comment">// DOM0级 IE</span></span><br><span class="line">			element.detachEvent(<span class="string">'on'</span> + type, handler);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123; <span class="comment">// HTML事件</span></span><br><span class="line">			element[<span class="string">'on'</span> + type] = <span class="literal">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;，</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取事件对象</span></span><br><span class="line">	getEvent: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> event ? event : <span class="built_in">window</span>.event;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取事件类型</span></span><br><span class="line">	getType: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> event.type;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取事件目标对象</span></span><br><span class="line">	getElement: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> event.target || event.srcElement;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 阻止事件的默认行为</span></span><br><span class="line">	preventDefault: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (event.preventDefault) &#123;</span><br><span class="line">			event.preventDefaul();</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			event.returnValue = <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 阻止冒泡</span></span><br><span class="line">	stopPropagation: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (event.stopPropagation) &#123;</span><br><span class="line">			event.stopPropagation();</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			event.cancelBubble = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2014/10/06/learn-coffeeScript/" class="prev">PREV</a><a href="/2014/10/04/learn-javascript/" class="next">NEXT</a></div><div class="copyright"><p>© 2014 - 2018 <a href="http://fy98.com">Frank Fan</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>